version: '3.8'

services:
  # Microservices (Production Configuration)
  api-gateway:
    build:
      context: .
      dockerfile: services/api_gateway/Dockerfile
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - SERVICE_NAME=api-gateway
      - SERVICE_PORT=8000
      - AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION}
      - ENVIRONMENT=production
    networks:
      - inventory-network
    restart: unless-stopped
    deploy:
      replicas: 2
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
    logging:
      driver: awslogs
      options:
        awslogs-group: "/ecs/inventory-management/api-gateway"
        awslogs-region: "${AWS_DEFAULT_REGION}"
        awslogs-stream-prefix: "ecs"
        tag: "api-gateway/{{.ID}}"

  inventory-service:
    build:
      context: .
      dockerfile: services/inventory/Dockerfile
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - SERVICE_NAME=inventory-service
      - SERVICE_PORT=8001
      - AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION}
      - ENVIRONMENT=production
    networks:
      - inventory-network
    restart: unless-stopped
    deploy:
      replicas: 2
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
    logging:
      driver: awslogs
      options:
        awslogs-group: "/ecs/inventory-management/inventory-service"
        awslogs-region: "${AWS_DEFAULT_REGION}"
        awslogs-stream-prefix: "ecs"
        tag: "inventory-service/{{.ID}}"

  location-service:
    build:
      context: .
      dockerfile: services/location/Dockerfile
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - SERVICE_NAME=location-service
      - SERVICE_PORT=8002
      - AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION}
      - ENVIRONMENT=production
    networks:
      - inventory-network
    restart: unless-stopped
    deploy:
      replicas: 2
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
    logging:
      driver: awslogs
      options:
        awslogs-group: "/ecs/inventory-management/location-service"
        awslogs-region: "${AWS_DEFAULT_REGION}"
        awslogs-stream-prefix: "ecs"
        tag: "location-service/{{.ID}}"

  user-service:
    build:
      context: .
      dockerfile: services/user/Dockerfile
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - SERVICE_NAME=user-service
      - SERVICE_PORT=8003
      - AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION}
      - ENVIRONMENT=production
    networks:
      - inventory-network
    restart: unless-stopped
    deploy:
      replicas: 2
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
    logging:
      driver: awslogs
      options:
        awslogs-group: "/ecs/inventory-management/user-service"
        awslogs-region: "${AWS_DEFAULT_REGION}"
        awslogs-stream-prefix: "ecs"
        tag: "user-service/{{.ID}}"

  reporting-service:
    build:
      context: .
      dockerfile: services/reporting/Dockerfile
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - SERVICE_NAME=reporting-service
      - SERVICE_PORT=8004
      - AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION}
      - ENVIRONMENT=production
    networks:
      - inventory-network
    restart: unless-stopped
    deploy:
      replicas: 2
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
    logging:
      driver: awslogs
      options:
        awslogs-group: "/ecs/inventory-management/reporting-service"
        awslogs-region: "${AWS_DEFAULT_REGION}"
        awslogs-stream-prefix: "ecs"
        tag: "reporting-service/{{.ID}}"

  ui-service:
    build:
      context: .
      dockerfile: services/ui/Dockerfile
    environment:
      - API_GATEWAY_URL=${API_GATEWAY_URL}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - SERVICE_NAME=ui-service
      - SERVICE_PORT=80
      - ENVIRONMENT=production
    networks:
      - inventory-network
    restart: unless-stopped
    deploy:
      replicas: 2
      resources:
        limits:
          cpus: '0.25'
          memory: 256M
        reservations:
          cpus: '0.125'
          memory: 128M
    logging:
      driver: awslogs
      options:
        awslogs-group: "/ecs/inventory-management/ui-service"
        awslogs-region: "${AWS_DEFAULT_REGION}"
        awslogs-stream-prefix: "ecs"
        tag: "ui-service/{{.ID}}"

networks:
  inventory-network:
    driver: overlay
    labels:
      - "project=inventory-management"
      - "environment=production"